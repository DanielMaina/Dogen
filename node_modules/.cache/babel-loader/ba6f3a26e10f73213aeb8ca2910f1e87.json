{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar Security_1 = require(\"./Security\");\n\nvar Api_1 = require(\"../api/Api\");\n\nvar WindowMode_1 = require(\"../models/WindowMode\");\n\nvar Signer_1 = require(\"../signer/Signer\");\n\nvar Utils_1 = tslib_1.__importDefault(require(\"../utils/Utils\"));\n\nvar Flows_1 = require(\"./Flows\");\n\nvar ArkaneConnect =\n/** @class */\nfunction () {\n  function ArkaneConnect(clientId, options) {\n    var _this = this;\n\n    this.clientId = clientId;\n    this.signUsing = options && options.signUsing || WindowMode_1.WindowMode.POPUP;\n    this.windowMode = options && options.windowMode || WindowMode_1.WindowMode.POPUP;\n    this.useOverlayWithPopup = options && options.useOverlayWithPopup != undefined ? options.useOverlayWithPopup : true;\n    Utils_1.default.rawEnvironment = options && options.environment || 'prod';\n\n    this._bearerTokenProvider = options && options.bearerTokenProvider || function () {\n      return _this.loginResult && _this.loginResult.authenticated && _this.auth && _this.auth.token || '';\n    };\n\n    if (this._bearerTokenProvider) {\n      this.api = new Api_1.Api(Utils_1.default.urls.api, this._bearerTokenProvider);\n    }\n\n    this.flows = new Flows_1.Flows(this, this.clientId);\n  }\n\n  ArkaneConnect.prototype.checkAuthenticated = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var loginResult;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!this.loginResult) return [3\n            /*break*/\n            , 1];\n            return [2\n            /*return*/\n            , this.afterAuthentication(this.loginResult)];\n\n          case 1:\n            return [4\n            /*yield*/\n            , Security_1.Security.checkAuthenticated(this.clientId)];\n\n          case 2:\n            loginResult = _a.sent();\n            return [2\n            /*return*/\n            , this.afterAuthentication(loginResult)];\n        }\n      });\n    });\n  };\n\n  ArkaneConnect.prototype.logout = function (options) {\n    var _this = this;\n\n    this.loginResult = undefined;\n    var windowMode = options && options.windowMode || this.windowMode;\n\n    if (windowMode === WindowMode_1.WindowMode.REDIRECT) {\n      return new Promise(function (resolve, reject) {\n        var logoutOptions = {};\n\n        if (options && options.redirectUri) {\n          Object.assign(logoutOptions, {\n            redirectUri: options.redirectUri\n          });\n        }\n\n        _this.auth ? _this.auth.logout(logoutOptions).then(function () {\n          return resolve();\n        }).catch(function () {\n          return reject;\n        }) : resolve();\n      });\n    } else {\n      if (this.auth) {\n        return Security_1.Security.logout(this.auth).then(function () {\n          return _this.auth = undefined;\n        });\n      } else {\n        return Promise.resolve();\n      }\n    }\n  };\n\n  ArkaneConnect.prototype.addOnTokenRefreshCallback = function (tokenRefreshCallback) {\n    if (tokenRefreshCallback) {\n      Security_1.Security.onTokenUpdate = tokenRefreshCallback;\n    }\n  };\n\n  ArkaneConnect.prototype.createSigner = function (windowMode, popupOptions) {\n    if (!popupOptions || popupOptions.useOverlay == undefined) {\n      popupOptions = {\n        useOverlay: this.useOverlayWithPopup\n      };\n    }\n\n    return Signer_1.SignerFactory.createSignerFor(windowMode || this.signUsing || this.windowMode, this._bearerTokenProvider, popupOptions);\n  };\n\n  ArkaneConnect.prototype.isPopupSigner = function (signer) {\n    return typeof signer.closePopup !== 'undefined';\n  };\n  /* Deprecated - Use flows.authenticate instead */\n\n\n  ArkaneConnect.prototype.authenticate = function (options) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      return tslib_1.__generator(this, function (_a) {\n        return [2\n        /*return*/\n        , this.flows.authenticate(options)];\n      });\n    });\n  };\n  /* Deprecated - Use flows.manageWallets instead */\n\n\n  ArkaneConnect.prototype.manageWallets = function (chain, options) {\n    return this.flows.manageWallets(chain, options);\n  };\n  /* Deprecated - Use flows.linkWallets instead */\n\n\n  ArkaneConnect.prototype.linkWallets = function (options) {\n    return this.flows.linkWallets(options);\n  };\n\n  ArkaneConnect.prototype._afterAuthenticationForFlowUse = function (loginResult) {\n    return this.afterAuthentication(loginResult);\n  };\n\n  ArkaneConnect.prototype.afterAuthentication = function (loginResult) {\n    // this.auth is needed for the bearerTokenProvider\n    this.loginResult = loginResult;\n    this.auth = loginResult.keycloak;\n    return {\n      auth: this.auth,\n      isAuthenticated: loginResult.authenticated,\n      authenticated: function (callback) {\n        if (loginResult.authenticated && loginResult.keycloak) {\n          callback(loginResult.keycloak);\n        }\n\n        return this;\n      },\n      notAuthenticated: function (callback) {\n        if (!loginResult.authenticated) {\n          callback(loginResult.keycloak);\n        }\n\n        return this;\n      }\n    };\n  };\n\n  return ArkaneConnect;\n}();\n\nexports.ArkaneConnect = ArkaneConnect;","map":{"version":3,"sources":["../../../src/connect/connect.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar Security_1 = require(\"./Security\");\nvar Api_1 = require(\"../api/Api\");\nvar WindowMode_1 = require(\"../models/WindowMode\");\nvar Signer_1 = require(\"../signer/Signer\");\nvar Utils_1 = tslib_1.__importDefault(require(\"../utils/Utils\"));\nvar Flows_1 = require(\"./Flows\");\nvar ArkaneConnect = /** @class */ (function () {\n    function ArkaneConnect(clientId, options) {\n        var _this = this;\n        this.clientId = clientId;\n        this.signUsing = (options && options.signUsing) || WindowMode_1.WindowMode.POPUP;\n        this.windowMode = (options && options.windowMode) || WindowMode_1.WindowMode.POPUP;\n        this.useOverlayWithPopup = (options && options.useOverlayWithPopup != undefined) ? options.useOverlayWithPopup : true;\n        Utils_1.default.rawEnvironment = options && options.environment || 'prod';\n        this._bearerTokenProvider = options && options.bearerTokenProvider || (function () { return _this.loginResult && _this.loginResult.authenticated && _this.auth && _this.auth.token || ''; });\n        if (this._bearerTokenProvider) {\n            this.api = new Api_1.Api(Utils_1.default.urls.api, this._bearerTokenProvider);\n        }\n        this.flows = new Flows_1.Flows(this, this.clientId);\n    }\n    ArkaneConnect.prototype.checkAuthenticated = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var loginResult;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.loginResult) return [3 /*break*/, 1];\n                        return [2 /*return*/, this.afterAuthentication(this.loginResult)];\n                    case 1: return [4 /*yield*/, Security_1.Security.checkAuthenticated(this.clientId)];\n                    case 2:\n                        loginResult = _a.sent();\n                        return [2 /*return*/, this.afterAuthentication(loginResult)];\n                }\n            });\n        });\n    };\n    ArkaneConnect.prototype.logout = function (options) {\n        var _this = this;\n        this.loginResult = undefined;\n        var windowMode = options && options.windowMode || this.windowMode;\n        if (windowMode === WindowMode_1.WindowMode.REDIRECT) {\n            return new Promise(function (resolve, reject) {\n                var logoutOptions = {};\n                if (options && options.redirectUri) {\n                    Object.assign(logoutOptions, { redirectUri: options.redirectUri });\n                }\n                _this.auth ? _this.auth.logout(logoutOptions).then(function () { return resolve(); }).catch(function () { return reject; }) : resolve();\n            });\n        }\n        else {\n            if (this.auth) {\n                return Security_1.Security.logout(this.auth).then(function () { return _this.auth = undefined; });\n            }\n            else {\n                return Promise.resolve();\n            }\n        }\n    };\n    ArkaneConnect.prototype.addOnTokenRefreshCallback = function (tokenRefreshCallback) {\n        if (tokenRefreshCallback) {\n            Security_1.Security.onTokenUpdate = tokenRefreshCallback;\n        }\n    };\n    ArkaneConnect.prototype.createSigner = function (windowMode, popupOptions) {\n        if (!popupOptions || popupOptions.useOverlay == undefined) {\n            popupOptions = { useOverlay: this.useOverlayWithPopup };\n        }\n        return Signer_1.SignerFactory.createSignerFor(windowMode || this.signUsing || this.windowMode, this._bearerTokenProvider, popupOptions);\n    };\n    ArkaneConnect.prototype.isPopupSigner = function (signer) {\n        return typeof signer.closePopup !== 'undefined';\n    };\n    /* Deprecated - Use flows.authenticate instead */\n    ArkaneConnect.prototype.authenticate = function (options) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                return [2 /*return*/, this.flows.authenticate(options)];\n            });\n        });\n    };\n    /* Deprecated - Use flows.manageWallets instead */\n    ArkaneConnect.prototype.manageWallets = function (chain, options) {\n        return this.flows.manageWallets(chain, options);\n    };\n    /* Deprecated - Use flows.linkWallets instead */\n    ArkaneConnect.prototype.linkWallets = function (options) {\n        return this.flows.linkWallets(options);\n    };\n    ArkaneConnect.prototype._afterAuthenticationForFlowUse = function (loginResult) {\n        return this.afterAuthentication(loginResult);\n    };\n    ArkaneConnect.prototype.afterAuthentication = function (loginResult) {\n        // this.auth is needed for the bearerTokenProvider\n        this.loginResult = loginResult;\n        this.auth = loginResult.keycloak;\n        return {\n            auth: this.auth,\n            isAuthenticated: loginResult.authenticated,\n            authenticated: function (callback) {\n                if (loginResult.authenticated && loginResult.keycloak) {\n                    callback(loginResult.keycloak);\n                }\n                return this;\n            },\n            notAuthenticated: function (callback) {\n                if (!loginResult.authenticated) {\n                    callback(loginResult.keycloak);\n                }\n                return this;\n            },\n        };\n    };\n    return ArkaneConnect;\n}());\nexports.ArkaneConnect = ArkaneConnect;\n//# sourceMappingURL=connect.js.map"]},"metadata":{},"sourceType":"script"}