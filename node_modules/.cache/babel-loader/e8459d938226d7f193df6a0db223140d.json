{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar Utils_1 = tslib_1.__importDefault(require(\"../utils/Utils\"));\n\nvar GeneralPopup_1 = require(\"../popup/GeneralPopup\");\n\nvar PopupActions_1 = require(\"../popup/PopupActions\");\n\nvar Security_1 = require(\"./Security\");\n\nvar WindowMode_1 = require(\"../models/WindowMode\");\n\nvar Flows =\n/** @class */\nfunction () {\n  function Flows(arkaneConnect, clientId) {\n    this.clientId = clientId;\n    this.arkaneConnect = arkaneConnect;\n  }\n\n  Flows.prototype.authenticate = function (options) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var authOptions, loginResult;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            authOptions = tslib_1.__assign({}, options);\n            authOptions.windowMode = authOptions.windowMode || this.arkaneConnect.windowMode;\n            return [4\n            /*yield*/\n            , Security_1.Security.login(this.clientId, authOptions)];\n\n          case 1:\n            loginResult = _a.sent();\n            return [2\n            /*return*/\n            , this.arkaneConnect._afterAuthenticationForFlowUse(loginResult)];\n        }\n      });\n    });\n  };\n\n  Flows.prototype.manageWallets = function (chain, options) {\n    var windowMode = options && options.windowMode || this.arkaneConnect.windowMode;\n    var useOverlayWithPopup = options && options.useOverlayWithPopup != undefined ? options.useOverlayWithPopup : this.arkaneConnect.useOverlayWithPopup;\n\n    if (windowMode === WindowMode_1.WindowMode.REDIRECT) {\n      return this.manageWalletsRedirect(chain, options);\n    } else {\n      return this.manageWalletsPopup(chain, {\n        useOverlay: useOverlayWithPopup\n      });\n    }\n  };\n\n  Flows.prototype.linkWallets = function (options) {\n    var windowMode = options && options.windowMode || this.arkaneConnect.windowMode;\n    var useOverlayWithPopup = options && options.useOverlayWithPopup != undefined ? options.useOverlayWithPopup : this.arkaneConnect.useOverlayWithPopup;\n\n    if (windowMode === WindowMode_1.WindowMode.REDIRECT) {\n      return this.linkWalletsRedirect(options);\n    } else {\n      return this.linkWalletsPopup({\n        useOverlay: useOverlayWithPopup\n      });\n    }\n  };\n\n  Flows.prototype.claimWallets = function (options) {\n    var windowMode = options && options.windowMode || this.arkaneConnect.windowMode;\n    var useOverlayWithPopup = options && options.useOverlayWithPopup || this.arkaneConnect.useOverlayWithPopup;\n\n    if (windowMode === WindowMode_1.WindowMode.REDIRECT) {\n      return this.claimWalletsRedirect(options);\n    } else {\n      return this.claimWalletsPopup({\n        useOverlay: useOverlayWithPopup\n      });\n    }\n  };\n\n  Flows.prototype.getAccount = function (chain, authenticationOptions) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var loginResult, wallets, start, options, result, popupResult, e_1, timeout;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            loginResult = {};\n            wallets = [];\n            start = +Date.now();\n            _a.label = 1;\n\n          case 1:\n            _a.trys.push([1, 7,, 8]);\n\n            options = {\n              windowMode: WindowMode_1.WindowMode.POPUP,\n              closePopup: false\n            };\n\n            if (authenticationOptions && authenticationOptions.idpHint) {\n              options.idpHint = authenticationOptions.idpHint;\n            }\n\n            return [4\n            /*yield*/\n            , Security_1.Security.login(this.clientId, options)];\n\n          case 2:\n            loginResult = _a.sent();\n            result = this.arkaneConnect._afterAuthenticationForFlowUse(loginResult);\n            if (!result.isAuthenticated) return [3\n            /*break*/\n            , 6];\n            return [4\n            /*yield*/\n            , this.arkaneConnect.api.getWallets({\n              secretType: chain.toUpperCase()\n            })];\n\n          case 3:\n            wallets = _a.sent();\n            if (!!(wallets && wallets.length > 0)) return [3\n            /*break*/\n            , 6];\n            return [4\n            /*yield*/\n            , this.manageWallets(chain, {\n              windowMode: WindowMode_1.WindowMode.POPUP\n            })];\n\n          case 4:\n            popupResult = _a.sent();\n            if (!(popupResult && popupResult.status === 'SUCCESS')) return [3\n            /*break*/\n            , 6];\n            return [4\n            /*yield*/\n            , this.arkaneConnect.api.getWallets({\n              secretType: chain.toUpperCase()\n            })];\n\n          case 5:\n            wallets = _a.sent();\n            _a.label = 6;\n\n          case 6:\n            if (!result.isAuthenticated || wallets.length === 0) {\n              throw Error('Something went wrong.');\n            }\n\n            return [3\n            /*break*/\n            , 8];\n\n          case 7:\n            e_1 = _a.sent();\n            console.error(e_1);\n            return [3\n            /*break*/\n            , 8];\n\n          case 8:\n            if (loginResult && loginResult.popupWindow) {\n              timeout = 1500 - (+Date.now() - start);\n\n              if (timeout <= 0) {\n                loginResult.popupWindow.close();\n              } else {\n                setTimeout(function () {\n                  loginResult.popupWindow.close();\n                }, timeout);\n              }\n            }\n\n            return [2\n            /*return*/\n            , {\n              wallets: wallets,\n              auth: loginResult.keycloak,\n              isAuthenticated: loginResult.authenticated\n            }];\n        }\n      });\n    });\n  };\n\n  Flows.prototype.manageWalletsRedirect = function (chain, options) {\n    Utils_1.default.http().postInForm(Utils_1.default.urls.connect + \"/wallets/manage\", {\n      chain: chain.toLowerCase()\n    }, this.arkaneConnect._bearerTokenProvider, options);\n    return Promise.resolve();\n  };\n\n  Flows.prototype.manageWalletsPopup = function (chain, options) {\n    return GeneralPopup_1.GeneralPopup.openNewPopup(PopupActions_1.PopupActions.MANAGE_WALLETS, this.arkaneConnect._bearerTokenProvider, {\n      chain: chain.toLowerCase()\n    }, options);\n  };\n\n  Flows.prototype.linkWalletsRedirect = function (options) {\n    Utils_1.default.http().postInForm(Utils_1.default.urls.connect + \"/wallets/link\", {}, this.arkaneConnect._bearerTokenProvider, options);\n    return Promise.resolve();\n  };\n\n  Flows.prototype.linkWalletsPopup = function (options) {\n    return GeneralPopup_1.GeneralPopup.openNewPopup(PopupActions_1.PopupActions.LINK_WALLET, this.arkaneConnect._bearerTokenProvider, undefined, options);\n  };\n\n  Flows.prototype.claimWalletsRedirect = function (options) {\n    Utils_1.default.http().postInForm(Utils_1.default.urls.connect + \"/wallets/claim\", {}, this.arkaneConnect._bearerTokenProvider, options);\n    return Promise.resolve();\n  };\n\n  Flows.prototype.claimWalletsPopup = function (options) {\n    return GeneralPopup_1.GeneralPopup.openNewPopup(PopupActions_1.PopupActions.CLAIM_WALLETS, this.arkaneConnect._bearerTokenProvider, undefined, options);\n  };\n\n  return Flows;\n}();\n\nexports.Flows = Flows;","map":{"version":3,"sources":["../../../src/connect/Flows.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar Utils_1 = tslib_1.__importDefault(require(\"../utils/Utils\"));\nvar GeneralPopup_1 = require(\"../popup/GeneralPopup\");\nvar PopupActions_1 = require(\"../popup/PopupActions\");\nvar Security_1 = require(\"./Security\");\nvar WindowMode_1 = require(\"../models/WindowMode\");\nvar Flows = /** @class */ (function () {\n    function Flows(arkaneConnect, clientId) {\n        this.clientId = clientId;\n        this.arkaneConnect = arkaneConnect;\n    }\n    Flows.prototype.authenticate = function (options) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var authOptions, loginResult;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        authOptions = tslib_1.__assign({}, options);\n                        authOptions.windowMode = authOptions.windowMode || this.arkaneConnect.windowMode;\n                        return [4 /*yield*/, Security_1.Security.login(this.clientId, authOptions)];\n                    case 1:\n                        loginResult = _a.sent();\n                        return [2 /*return*/, this.arkaneConnect._afterAuthenticationForFlowUse(loginResult)];\n                }\n            });\n        });\n    };\n    Flows.prototype.manageWallets = function (chain, options) {\n        var windowMode = options && options.windowMode || this.arkaneConnect.windowMode;\n        var useOverlayWithPopup = options && options.useOverlayWithPopup != undefined ? options.useOverlayWithPopup : this.arkaneConnect.useOverlayWithPopup;\n        if (windowMode === WindowMode_1.WindowMode.REDIRECT) {\n            return this.manageWalletsRedirect(chain, options);\n        }\n        else {\n            return this.manageWalletsPopup(chain, { useOverlay: useOverlayWithPopup });\n        }\n    };\n    Flows.prototype.linkWallets = function (options) {\n        var windowMode = options && options.windowMode || this.arkaneConnect.windowMode;\n        var useOverlayWithPopup = options && options.useOverlayWithPopup != undefined ? options.useOverlayWithPopup : this.arkaneConnect.useOverlayWithPopup;\n        if (windowMode === WindowMode_1.WindowMode.REDIRECT) {\n            return this.linkWalletsRedirect(options);\n        }\n        else {\n            return this.linkWalletsPopup({ useOverlay: useOverlayWithPopup });\n        }\n    };\n    Flows.prototype.claimWallets = function (options) {\n        var windowMode = options && options.windowMode || this.arkaneConnect.windowMode;\n        var useOverlayWithPopup = options && options.useOverlayWithPopup || this.arkaneConnect.useOverlayWithPopup;\n        if (windowMode === WindowMode_1.WindowMode.REDIRECT) {\n            return this.claimWalletsRedirect(options);\n        }\n        else {\n            return this.claimWalletsPopup({ useOverlay: useOverlayWithPopup });\n        }\n    };\n    Flows.prototype.getAccount = function (chain, authenticationOptions) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var loginResult, wallets, start, options, result, popupResult, e_1, timeout;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        loginResult = {};\n                        wallets = [];\n                        start = +Date.now();\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 7, , 8]);\n                        options = { windowMode: WindowMode_1.WindowMode.POPUP, closePopup: false };\n                        if (authenticationOptions && authenticationOptions.idpHint) {\n                            options.idpHint = authenticationOptions.idpHint;\n                        }\n                        return [4 /*yield*/, Security_1.Security.login(this.clientId, options)];\n                    case 2:\n                        loginResult = _a.sent();\n                        result = this.arkaneConnect._afterAuthenticationForFlowUse(loginResult);\n                        if (!result.isAuthenticated) return [3 /*break*/, 6];\n                        return [4 /*yield*/, this.arkaneConnect.api.getWallets({ secretType: chain.toUpperCase() })];\n                    case 3:\n                        wallets = _a.sent();\n                        if (!!(wallets && wallets.length > 0)) return [3 /*break*/, 6];\n                        return [4 /*yield*/, this.manageWallets(chain, { windowMode: WindowMode_1.WindowMode.POPUP })];\n                    case 4:\n                        popupResult = _a.sent();\n                        if (!(popupResult && popupResult.status === 'SUCCESS')) return [3 /*break*/, 6];\n                        return [4 /*yield*/, this.arkaneConnect.api.getWallets({ secretType: chain.toUpperCase() })];\n                    case 5:\n                        wallets = _a.sent();\n                        _a.label = 6;\n                    case 6:\n                        if (!result.isAuthenticated || wallets.length === 0) {\n                            throw Error('Something went wrong.');\n                        }\n                        return [3 /*break*/, 8];\n                    case 7:\n                        e_1 = _a.sent();\n                        console.error(e_1);\n                        return [3 /*break*/, 8];\n                    case 8:\n                        if (loginResult && loginResult.popupWindow) {\n                            timeout = 1500 - (+Date.now() - start);\n                            if (timeout <= 0) {\n                                loginResult.popupWindow.close();\n                            }\n                            else {\n                                setTimeout(function () {\n                                    loginResult.popupWindow.close();\n                                }, timeout);\n                            }\n                        }\n                        return [2 /*return*/, {\n                                wallets: wallets,\n                                auth: loginResult.keycloak,\n                                isAuthenticated: loginResult.authenticated\n                            }];\n                }\n            });\n        });\n    };\n    Flows.prototype.manageWalletsRedirect = function (chain, options) {\n        Utils_1.default.http().postInForm(Utils_1.default.urls.connect + \"/wallets/manage\", { chain: chain.toLowerCase() }, this.arkaneConnect._bearerTokenProvider, options);\n        return Promise.resolve();\n    };\n    Flows.prototype.manageWalletsPopup = function (chain, options) {\n        return GeneralPopup_1.GeneralPopup.openNewPopup(PopupActions_1.PopupActions.MANAGE_WALLETS, this.arkaneConnect._bearerTokenProvider, { chain: chain.toLowerCase() }, options);\n    };\n    Flows.prototype.linkWalletsRedirect = function (options) {\n        Utils_1.default.http().postInForm(Utils_1.default.urls.connect + \"/wallets/link\", {}, this.arkaneConnect._bearerTokenProvider, options);\n        return Promise.resolve();\n    };\n    Flows.prototype.linkWalletsPopup = function (options) {\n        return GeneralPopup_1.GeneralPopup.openNewPopup(PopupActions_1.PopupActions.LINK_WALLET, this.arkaneConnect._bearerTokenProvider, undefined, options);\n    };\n    Flows.prototype.claimWalletsRedirect = function (options) {\n        Utils_1.default.http().postInForm(Utils_1.default.urls.connect + \"/wallets/claim\", {}, this.arkaneConnect._bearerTokenProvider, options);\n        return Promise.resolve();\n    };\n    Flows.prototype.claimWalletsPopup = function (options) {\n        return GeneralPopup_1.GeneralPopup.openNewPopup(PopupActions_1.PopupActions.CLAIM_WALLETS, this.arkaneConnect._bearerTokenProvider, undefined, options);\n    };\n    return Flows;\n}());\nexports.Flows = Flows;\n//# sourceMappingURL=Flows.js.map"]},"metadata":{},"sourceType":"script"}