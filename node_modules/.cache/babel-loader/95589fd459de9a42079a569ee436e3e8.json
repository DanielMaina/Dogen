{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Arkane = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar ArkaneWalletSubProvider_1 = require(\"./ArkaneWalletSubProvider\");\n\nvar NonceTracker_1 = require(\"./NonceTracker\");\n\nvar SignedVersionedTypedDataSubProvider_1 = require(\"./SignedVersionedTypedDataSubProvider\");\n\nvar arkane_connect_1 = require(\"@arkane-network/arkane-connect\");\n\nvar SignTransactionGasFix_1 = require(\"./SignTransactionGasFix\");\n\nvar ProviderEngine = require('@arkane-network/web3-provider-engine');\n\nvar CacheSubprovider = require('@arkane-network/web3-provider-engine/subproviders/cache');\n\nvar FixtureSubprovider = require('@arkane-network/web3-provider-engine/subproviders/fixture');\n\nvar FilterSubprovider = require('@arkane-network/web3-provider-engine/subproviders/filters');\n\nvar RpcSubprovider = require('@arkane-network/web3-provider-engine/subproviders/rpc');\n\nvar SubscriptionsSubprovider = require('@arkane-network/web3-provider-engine/subproviders/subscriptions');\n\nvar SanitizingSubprovider = require('@arkane-network/web3-provider-engine/subproviders/sanitizer');\n\nvar InflightCacheSubprovider = require('@arkane-network/web3-provider-engine/subproviders/inflight-cache');\n\nvar WebsocketSubprovider = require('@arkane-network/web3-provider-engine/subproviders/websocket');\n\nvar ArkaneSubProvider =\n/** @class */\nfunction () {\n  function ArkaneSubProvider() {}\n\n  ArkaneSubProvider.prototype.arkaneConnect = function () {\n    return this.ac;\n  };\n\n  ArkaneSubProvider.prototype.changeSecretType = function (secretType) {\n    if (secretType === void 0) {\n      secretType = arkane_connect_1.SecretType.ETHEREUM;\n    }\n\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      return tslib_1.__generator(this, function (_a) {\n        if (this.arkaneSubProvider && this.arkaneSubProvider.options) {\n          this.arkaneSubProvider.options.secretType = secretType;\n          this.arkaneSubProvider.lastWalletsFetch = undefined;\n          this.engine.stop();\n          return [2\n          /*return*/\n          , this.createArkaneProviderEngine(this.arkaneSubProvider.options)];\n        }\n\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n\n  ArkaneSubProvider.prototype.checkAuthenticated = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      return tslib_1.__generator(this, function (_a) {\n        if (!this.arkaneSubProvider) {\n          throw new Error(\"Please initialise provider first (Arkane.createArkaneProviderEngine)\");\n        }\n\n        return [2\n        /*return*/\n        , this.arkaneSubProvider.checkAuthenticated()];\n      });\n    });\n  };\n\n  ArkaneSubProvider.prototype.authenticate = function (authenticationOptions) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      return tslib_1.__generator(this, function (_a) {\n        if (!this.arkaneSubProvider) {\n          throw new Error(\"Please initialise provider first (Arkane.createArkaneProviderEngine)\");\n        }\n\n        return [2\n        /*return*/\n        , this.arkaneSubProvider.startGetAccountFlow(authenticationOptions)];\n      });\n    });\n  };\n\n  ArkaneSubProvider.prototype.createArkaneProviderEngine = function (options) {\n    var _this = this;\n\n    var connectionDetails = this.getConnectionDetails(options);\n    this.engine = new ProviderEngine({\n      pollingInterval: options.pollingInterval || 15000\n    });\n    this.engine.addProvider(new FixtureSubprovider({\n      web3_clientVersion: 'ArkaneProviderEngine/v0.21.0/javascript',\n      net_listening: true,\n      eth_hashrate: '0x00',\n      eth_mining: false,\n      eth_syncing: true\n    }));\n    this.engine.addProvider(new SignTransactionGasFix_1.SignTransactionGasFix());\n\n    if (!this.arkaneSubProvider) {\n      this.arkaneSubProvider = new ArkaneWalletSubProvider_1.ArkaneWalletSubProvider(options);\n    }\n\n    this.ac = this.arkaneSubProvider.arkaneConnect;\n\n    if (!this.signedVersionedTypedDataSubProvider) {\n      this.signedVersionedTypedDataSubProvider = new SignedVersionedTypedDataSubProvider_1.SignedVersionedTypedDataSubProvider(this.arkaneSubProvider);\n    }\n\n    this.engine.addProvider(this.signedVersionedTypedDataSubProvider);\n    this.engine.addProvider(new FilterSubprovider());\n    this.nonceSubProvider = new NonceTracker_1.NonceTrackerSubprovider({\n      rpcUrl: connectionDetails.endpointHttpUrl\n    });\n    this.engine.addProvider(this.nonceSubProvider);\n    this.engine.addProvider(new SanitizingSubprovider());\n    this.engine.addProvider(new SubscriptionsSubprovider());\n    this.engine.addProvider(new CacheSubprovider());\n    this.engine.addProvider(new InflightCacheSubprovider());\n    this.rpcSubprovider = new RpcSubprovider({\n      rpcUrl: connectionDetails.endpointHttpUrl\n    });\n    this.engine.addProvider(this.arkaneSubProvider);\n    this.engine.addProvider(this.rpcSubprovider);\n    return options.skipAuthentication ? Promise.resolve(this.startEngine(this.engine)) : this.arkaneSubProvider.getAccountsAsync().then(function () {\n      return _this.startEngine(_this.engine);\n    });\n  };\n\n  ArkaneSubProvider.prototype.getConnectionDetails = function (options) {\n    var secretType = options.secretType ? options.secretType : arkane_connect_1.SecretType.ETHEREUM;\n    var environment = options.environment;\n    environment = environment === null || environment === void 0 ? void 0 : environment.replace('-local', '');\n    var endpoint = secretType.toLowerCase() + \"-node\" + (environment && !environment.startsWith('prod') ? '-' + environment : '') + \".arkane.network\";\n    return {\n      endpointHttpUrl: 'https://' + endpoint\n    };\n  };\n\n  ArkaneSubProvider.prototype.startEngine = function (engine) {\n    // network connectivity error\n    engine.on('error', function (err) {\n      // report connectivity errors\n      console.error(err.stack);\n    }); // start polling for blocks\n\n    engine.start();\n    return engine;\n  };\n\n  return ArkaneSubProvider;\n}();\n\nvar ConnectionDetails =\n/** @class */\nfunction () {\n  function ConnectionDetails(endpointHttpUrl, endpointWsUrl) {\n    this.endpointHttpUrl = endpointHttpUrl;\n    this.endpointWsUrl = endpointWsUrl;\n  }\n\n  return ConnectionDetails;\n}();\n\nif (typeof window !== 'undefined') {\n  window.Arkane = new ArkaneSubProvider();\n}\n\nexports.Arkane = ArkaneSubProvider.prototype;","map":{"version":3,"sources":["../../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Arkane = void 0;\nvar tslib_1 = require(\"tslib\");\nvar ArkaneWalletSubProvider_1 = require(\"./ArkaneWalletSubProvider\");\nvar NonceTracker_1 = require(\"./NonceTracker\");\nvar SignedVersionedTypedDataSubProvider_1 = require(\"./SignedVersionedTypedDataSubProvider\");\nvar arkane_connect_1 = require(\"@arkane-network/arkane-connect\");\nvar SignTransactionGasFix_1 = require(\"./SignTransactionGasFix\");\nvar ProviderEngine = require('@arkane-network/web3-provider-engine');\nvar CacheSubprovider = require('@arkane-network/web3-provider-engine/subproviders/cache');\nvar FixtureSubprovider = require('@arkane-network/web3-provider-engine/subproviders/fixture');\nvar FilterSubprovider = require('@arkane-network/web3-provider-engine/subproviders/filters');\nvar RpcSubprovider = require('@arkane-network/web3-provider-engine/subproviders/rpc');\nvar SubscriptionsSubprovider = require('@arkane-network/web3-provider-engine/subproviders/subscriptions');\nvar SanitizingSubprovider = require('@arkane-network/web3-provider-engine/subproviders/sanitizer');\nvar InflightCacheSubprovider = require('@arkane-network/web3-provider-engine/subproviders/inflight-cache');\nvar WebsocketSubprovider = require('@arkane-network/web3-provider-engine/subproviders/websocket');\nvar ArkaneSubProvider = /** @class */ (function () {\n    function ArkaneSubProvider() {\n    }\n    ArkaneSubProvider.prototype.arkaneConnect = function () {\n        return this.ac;\n    };\n    ArkaneSubProvider.prototype.changeSecretType = function (secretType) {\n        if (secretType === void 0) { secretType = arkane_connect_1.SecretType.ETHEREUM; }\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                if (this.arkaneSubProvider && this.arkaneSubProvider.options) {\n                    this.arkaneSubProvider.options.secretType = secretType;\n                    this.arkaneSubProvider.lastWalletsFetch = undefined;\n                    this.engine.stop();\n                    return [2 /*return*/, this.createArkaneProviderEngine(this.arkaneSubProvider.options)];\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    ArkaneSubProvider.prototype.checkAuthenticated = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                if (!this.arkaneSubProvider) {\n                    throw new Error(\"Please initialise provider first (Arkane.createArkaneProviderEngine)\");\n                }\n                return [2 /*return*/, this.arkaneSubProvider.checkAuthenticated()];\n            });\n        });\n    };\n    ArkaneSubProvider.prototype.authenticate = function (authenticationOptions) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                if (!this.arkaneSubProvider) {\n                    throw new Error(\"Please initialise provider first (Arkane.createArkaneProviderEngine)\");\n                }\n                return [2 /*return*/, this.arkaneSubProvider.startGetAccountFlow(authenticationOptions)];\n            });\n        });\n    };\n    ArkaneSubProvider.prototype.createArkaneProviderEngine = function (options) {\n        var _this = this;\n        var connectionDetails = this.getConnectionDetails(options);\n        this.engine = new ProviderEngine({ pollingInterval: options.pollingInterval || 15000 });\n        this.engine.addProvider(new FixtureSubprovider({\n            web3_clientVersion: 'ArkaneProviderEngine/v0.21.0/javascript',\n            net_listening: true,\n            eth_hashrate: '0x00',\n            eth_mining: false,\n            eth_syncing: true,\n        }));\n        this.engine.addProvider(new SignTransactionGasFix_1.SignTransactionGasFix());\n        if (!this.arkaneSubProvider) {\n            this.arkaneSubProvider = new ArkaneWalletSubProvider_1.ArkaneWalletSubProvider(options);\n        }\n        this.ac = this.arkaneSubProvider.arkaneConnect;\n        if (!this.signedVersionedTypedDataSubProvider) {\n            this.signedVersionedTypedDataSubProvider = new SignedVersionedTypedDataSubProvider_1.SignedVersionedTypedDataSubProvider(this.arkaneSubProvider);\n        }\n        this.engine.addProvider(this.signedVersionedTypedDataSubProvider);\n        this.engine.addProvider(new FilterSubprovider());\n        this.nonceSubProvider = new NonceTracker_1.NonceTrackerSubprovider({ rpcUrl: connectionDetails.endpointHttpUrl });\n        this.engine.addProvider(this.nonceSubProvider);\n        this.engine.addProvider(new SanitizingSubprovider());\n        this.engine.addProvider(new SubscriptionsSubprovider());\n        this.engine.addProvider(new CacheSubprovider());\n        this.engine.addProvider(new InflightCacheSubprovider());\n        this.rpcSubprovider = new RpcSubprovider({ rpcUrl: connectionDetails.endpointHttpUrl });\n        this.engine.addProvider(this.arkaneSubProvider);\n        this.engine.addProvider(this.rpcSubprovider);\n        return options.skipAuthentication\n            ? Promise.resolve(this.startEngine(this.engine))\n            : this.arkaneSubProvider.getAccountsAsync().then(function () { return _this.startEngine(_this.engine); });\n    };\n    ArkaneSubProvider.prototype.getConnectionDetails = function (options) {\n        var secretType = options.secretType ? options.secretType : arkane_connect_1.SecretType.ETHEREUM;\n        var environment = options.environment;\n        environment = environment === null || environment === void 0 ? void 0 : environment.replace('-local', '');\n        var endpoint = secretType.toLowerCase() + \"-node\" + (environment && !environment.startsWith('prod') ? '-' + environment : '') + \".arkane.network\";\n        return {\n            endpointHttpUrl: 'https://' + endpoint\n        };\n    };\n    ArkaneSubProvider.prototype.startEngine = function (engine) {\n        // network connectivity error\n        engine.on('error', function (err) {\n            // report connectivity errors\n            console.error(err.stack);\n        });\n        // start polling for blocks\n        engine.start();\n        return engine;\n    };\n    return ArkaneSubProvider;\n}());\nvar ConnectionDetails = /** @class */ (function () {\n    function ConnectionDetails(endpointHttpUrl, endpointWsUrl) {\n        this.endpointHttpUrl = endpointHttpUrl;\n        this.endpointWsUrl = endpointWsUrl;\n    }\n    return ConnectionDetails;\n}());\nif (typeof window !== 'undefined') {\n    window.Arkane = new ArkaneSubProvider();\n}\nexports.Arkane = ArkaneSubProvider.prototype;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}