{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar EventTypes_1 = require(\"../types/EventTypes\");\n\nvar Popup_1 = tslib_1.__importDefault(require(\"./Popup\"));\n\nvar Utils_1 = tslib_1.__importDefault(require(\"../utils/Utils\"));\n\nvar GeneralPopup =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(GeneralPopup, _super);\n\n  function GeneralPopup() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.finishedEventType = EventTypes_1.EventTypes.POPUP_FINISHED;\n    _this.sendDataEventType = EventTypes_1.EventTypes.SEND_DATA;\n    return _this;\n  }\n\n  GeneralPopup.openNewPopup = function (action, bearerTokenProvider, data, options) {\n    var popup = new GeneralPopup(Utils_1.default.urls.connect + \"/popup/general/init.html\", bearerTokenProvider, options);\n    window.addEventListener('beforeunload', function () {\n      popup.close();\n    });\n    popup.focus();\n    return popup.sendData(action, data && JSON.parse(JSON.stringify(data))).finally(function () {\n      popup.close();\n    });\n  };\n\n  GeneralPopup.prototype.sendData = function (action, data) {\n    var _this = this;\n\n    return new Promise(function (resolve, reject) {\n      _this.onPopupMountedQueue.push(_this.attachFinishedListener(resolve, reject));\n\n      _this.onPopupMountedQueue.push(_this.sendDataToPopup(action, data));\n\n      _this.processPopupMountedQueue();\n    });\n  };\n\n  GeneralPopup.prototype.sendDataToPopup = function (action, data) {\n    var _this = this;\n\n    return function () {\n      if (_this.isOpen()) {\n        var params = {\n          action: action,\n          bearerToken: _this.bearerTokenProvider()\n        };\n\n        if (data) {\n          params.data = data;\n        }\n\n        _this.popupWindow.postMessage({\n          type: _this.sendDataEventType,\n          params: params\n        }, Utils_1.default.urls.connect);\n      }\n    };\n  };\n\n  return GeneralPopup;\n}(Popup_1.default);\n\nexports.GeneralPopup = GeneralPopup;","map":{"version":3,"sources":["../../../src/popup/GeneralPopup.ts"],"names":[],"mappings":";;;;;;;;AAAA,IAAA,YAAA,GAAA,OAAA,CAAA,qBAAA,CAAA;;AACA,IAAA,OAAA,GAAA,OAAA,CAAA,eAAA,CAAA,OAAA,CAAA,SAAA,CAAA,CAAA;;AACA,IAAA,OAAA,GAAA,OAAA,CAAA,eAAA,CAAA,OAAA,CAAA,gBAAA,CAAA,CAAA;;AAIA,IAAA,YAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAAkC,EAAA,OAAA,CAAA,SAAA,CAAA,YAAA,EAAA,MAAA;;AAAlC,WAAA,YAAA,GAAA;AAAA,QAAA,KAAA,GAAA,MAAA,KAAA,IAAA,IAAA,MAAA,CAAA,KAAA,CAAA,IAAA,EAAA,SAAA,CAAA,IAAA,IAAA;;AA0Cc,IAAA,KAAA,CAAA,iBAAA,GAAgC,YAAA,CAAA,UAAA,CAAW,cAA3C;AACA,IAAA,KAAA,CAAA,iBAAA,GAAgC,YAAA,CAAA,UAAA,CAAW,SAA3C;;AAEb;;AA3CiB,EAAA,YAAA,CAAA,YAAA,GAAd,UAA2B,MAA3B,EAAiD,mBAAjD,EAAoF,IAApF,EAAgG,OAAhG,EAAsH;AAClH,QAAM,KAAK,GAAG,IAAI,YAAJ,CAAoB,OAAA,CAAA,OAAA,CAAM,IAAN,CAAW,OAAX,GAAkB,0BAAtC,EAAkE,mBAAlE,EAAuF,OAAvF,CAAd;AACA,IAAA,MAAM,CAAC,gBAAP,CAAwB,cAAxB,EAAwC,YAAA;AACpC,MAAA,KAAK,CAAC,KAAN;AACH,KAFD;AAGA,IAAA,KAAK,CAAC,KAAN;AACA,WAAO,KAAK,CAAC,QAAN,CAAe,MAAf,EAAuB,IAAI,IAAI,IAAI,CAAC,KAAL,CAAW,IAAI,CAAC,SAAL,CAAe,IAAf,CAAX,CAA/B,EAAiE,OAAjE,CAAyE,YAAA;AAC5E,MAAA,KAAK,CAAC,KAAN;AACH,KAFM,CAAP;AAGH,GATa;;AAWP,EAAA,YAAA,CAAA,SAAA,CAAA,QAAA,GAAP,UACI,MADJ,EAEI,IAFJ,EAEa;AAFb,QAAA,KAAA,GAAA,IAAA;;AAII,WAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAgB;AAC/B,MAAA,KAAI,CAAC,mBAAL,CAAyB,IAAzB,CAA8B,KAAI,CAAC,sBAAL,CAA4B,OAA5B,EAAqC,MAArC,CAA9B;;AACA,MAAA,KAAI,CAAC,mBAAL,CAAyB,IAAzB,CAA8B,KAAI,CAAC,eAAL,CAAqB,MAArB,EAA6B,IAA7B,CAA9B;;AACA,MAAA,KAAI,CAAC,wBAAL;AACH,KAJM,CAAP;AAKH,GATM;;AAWG,EAAA,YAAA,CAAA,SAAA,CAAA,eAAA,GAAV,UACI,MADJ,EAEI,IAFJ,EAEa;AAFb,QAAA,KAAA,GAAA,IAAA;;AAII,WAAO,YAAA;AACH,UAAI,KAAI,CAAC,MAAL,EAAJ,EAAmB;AACf,YAAI,MAAM,GAAG;AAAC,UAAA,MAAM,EAAA,MAAP;AAAS,UAAA,WAAW,EAAE,KAAI,CAAC,mBAAL;AAAtB,SAAb;;AACA,YAAI,IAAJ,EAAU;AACN,UAAA,MAAM,CAAC,IAAP,GAAc,IAAd;AACH;;AACD,QAAA,KAAI,CAAC,WAAL,CAAiB,WAAjB,CACI;AAAC,UAAA,IAAI,EAAE,KAAI,CAAC,iBAAZ;AAA+B,UAAA,MAAM,EAAA;AAArC,SADJ,EAEI,OAAA,CAAA,OAAA,CAAM,IAAN,CAAW,OAFf;AAIH;AACJ,KAXD;AAYH,GAhBS;;AAqBd,SAAA,YAAA;AAAC,CA7CD,CAAkC,OAAA,CAAA,OAAlC,CAAA;;AAAa,OAAA,CAAA,YAAA,GAAA,YAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar EventTypes_1 = require(\"../types/EventTypes\");\nvar Popup_1 = tslib_1.__importDefault(require(\"./Popup\"));\nvar Utils_1 = tslib_1.__importDefault(require(\"../utils/Utils\"));\nvar GeneralPopup = /** @class */ (function (_super) {\n    tslib_1.__extends(GeneralPopup, _super);\n    function GeneralPopup() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.finishedEventType = EventTypes_1.EventTypes.POPUP_FINISHED;\n        _this.sendDataEventType = EventTypes_1.EventTypes.SEND_DATA;\n        return _this;\n    }\n    GeneralPopup.openNewPopup = function (action, bearerTokenProvider, data, options) {\n        var popup = new GeneralPopup(Utils_1.default.urls.connect + \"/popup/general/init.html\", bearerTokenProvider, options);\n        window.addEventListener('beforeunload', function () {\n            popup.close();\n        });\n        popup.focus();\n        return popup.sendData(action, data && JSON.parse(JSON.stringify(data))).finally(function () {\n            popup.close();\n        });\n    };\n    GeneralPopup.prototype.sendData = function (action, data) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            _this.onPopupMountedQueue.push(_this.attachFinishedListener(resolve, reject));\n            _this.onPopupMountedQueue.push(_this.sendDataToPopup(action, data));\n            _this.processPopupMountedQueue();\n        });\n    };\n    GeneralPopup.prototype.sendDataToPopup = function (action, data) {\n        var _this = this;\n        return function () {\n            if (_this.isOpen()) {\n                var params = { action: action, bearerToken: _this.bearerTokenProvider() };\n                if (data) {\n                    params.data = data;\n                }\n                _this.popupWindow.postMessage({ type: _this.sendDataEventType, params: params }, Utils_1.default.urls.connect);\n            }\n        };\n    };\n    return GeneralPopup;\n}(Popup_1.default));\nexports.GeneralPopup = GeneralPopup;\n//# sourceMappingURL=GeneralPopup.js.map"]},"metadata":{},"sourceType":"script"}